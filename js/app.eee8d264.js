(function(t){function e(e){for(var a,o,r=e[0],c=e[1],l=e[2],h=0,v=[];h<r.length;h++)o=r[h],s[o]&&v.push(s[o][0]),s[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(v.length)v.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,r=1;r<n.length;r++){var c=n[r];0!==s[c]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},s={app:0},i=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var a=n("64a9"),s=n.n(a);s.a},1:function(t,e){},2:function(t,e){},2266:function(t,e,n){},3:function(t,e){},"38e6":function(t,e,n){"use strict";var a=n("aa54"),s=n.n(a);s.a},4:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("7f7f"),n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),s=n("54fe"),i=(n("4916"),n("ff8e")),o=n.n(i),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Canvas")],1)},c=[],l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app"},[n("div",{staticClass:"checker"},[n("span",[t._v(t._s(t.labeledNum)+" / "+t._s(t.totalNum))]),n("span",{staticClass:"tabs"},[t._l(t.cates,function(e){return n("span",{key:e.value,class:t.curCheckingCate===e.value?"live":"",on:{click:function(n){return t.showStrokesInCate(e.value)}}},[t._v(t._s(e.label))])}),n("span",{class:""===t.curCheckingCate?"live":"",on:{click:function(e){return t.showStrokesInCate("")}}},[t._v("NoLabel")])],2)]),n("div",{staticClass:"mode"},[n("span",{staticClass:"ctag"},[t._v(t._s(t.curMode))]),n("span",{class:"checking"===t.curMode?"icon-close-solid":"",on:{click:t.switchToLabelingMode}})]),n("div",{staticClass:"main"},[n("vue-scroll",[n("el-popover",{ref:"popover",style:t.popPos,attrs:{trigger:"manual",width:"150"}},[n("el-select",{attrs:{placeholder:"Label it ~"},on:{change:t.setLabel},model:{value:t.selectVal,callback:function(e){t.selectVal=e},expression:"selectVal"}},t._l(t.cates,function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),n("canvas",{attrs:{id:"canvas",width:"1920",height:"1080"}},[t._v("\n      Canvas is not supported in your browser:( Please upgrade.\n    ")])],1)],1),n("div",{staticClass:"toolbar clearfix"},[n("span",{staticClass:"tool"},[n("span",{staticClass:"icon-zoom-out",on:{click:function(e){return t.zoom(-1)}}}),n("span",{staticClass:"icon-zoom-in",on:{click:function(e){return t.zoom(1)}}})]),n("button",{staticClass:"finish",on:{click:t.finishLabeling}},[t._v("Finish")])]),n("canvas",{attrs:{id:"static-canvas",width:"1200",height:"675"}}),n("el-dialog",{attrs:{width:"70%",center:"",top:"20px",visible:t.finishDialog},on:{"update:visible":function(e){t.finishDialog=e}}},[n("div",{staticClass:"dbDialog"},[t.isDbChecked?n("div",{staticClass:"congrats"},[n("Congrats"),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("button",{staticClass:"done",on:{click:function(e){t.finishDialog=!1}}},[t._v("Done")])])],1):n("div",{staticClass:"dbchecker"},[n("h2",{staticClass:"title"},[t._v("Double Checking")]),n("div",{staticClass:"staticWrapper"},[n("vue-scroll",[n("img",{attrs:{src:t.canvasImg}})])],1),n("el-steps",{attrs:{active:t.activeStep,"finish-status":"success","align-center":!0}},t._l(t.cates,function(e){return n("el-step",{key:e.value,attrs:{title:e.label},nativeOn:{click:function(n){return t.setActiveStep(e.value)}}})}),1),n("button",{staticClass:"next",on:{click:t.nextCheckStep}},[t._v(t._s(t.activeText))])],1)])])],1)},u=[],h=(n("28a5"),n("e814")),v=n.n(h),f=(n("7514"),n("a4bb")),d=n.n(f),p=(n("ac6a"),n("7a94")),g=n("98fc"),b=n.n(g),m=n("21a6"),C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"congrats"},[n("div",{staticClass:"done-text"},[n("figure",[n("svg",{attrs:{id:"anim",xmlns:"http://www.w3.org/2000/svg","xmlns:sodipodi":"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd","xmlns:inkscape":"http://www.inkscape.org/namespaces/inkscape",viewBox:"0 0 370 106",version:"1.1"}},[n("g",{attrs:{id:"layer1",transform:"translate(0,-191.16665)"}},[n("text",{attrs:{"xml:space":"preserve",x:"0",y:"271"}},[n("tspan",{attrs:{"sodipodi:role":"line",x:"0",y:"271"}},[t._v("Dooone~")])])])])])]),t._m(0)])},k=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ghost"},[n("div",{staticClass:"body"},[n("div",{staticClass:"face"},[n("div",{staticClass:"eye left"}),n("div",{staticClass:"eye right"}),n("div",{staticClass:"smile"}),n("div",{staticClass:"rosy left"}),n("div",{staticClass:"rosy right"})]),n("div",{staticClass:"bottom"},[n("div"),n("div"),n("div"),n("div"),n("div")])]),n("div",{staticClass:"shadow"})])}],y={},w=y,x=(n("38e6"),n("2877")),S=Object(x["a"])(w,C,k,!1,null,"faf0d7f2",null),T=S.exports,_=n("d225"),P=n("b0b4"),M=function(){function t(e){Object(_["a"])(this,t),this.id=e,this.points=[]}return Object(P["a"])(t,[{key:"addPoint",value:function(t){this.points.push(t)}},{key:"getPoints",value:function(){return this.points}},{key:"getPoint",value:function(t){return this.points[t]}},{key:"length",value:function(){for(var t=this.points.Count,e=0,n=0;n<t-1;n++){var a=this.getPoint(n),s=this.getPoint(n+1);e+=a.dist(s)}return e}},{key:"setCategory",value:function(t){this.cate=t}}]),t}(),O=function(){function t(e,n){Object(_["a"])(this,t),this.x=e,this.y=n}return Object(P["a"])(t,[{key:"dist",value:function(t){var e=Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2);return Math.sqrt(e)}}]),t}(),j=960,D=540,L="rgba(100,100,100)",E="rgba(184,72,255)",N="rgba(100,100,100,0.3)",A=[{value:"1",label:"Text"},{value:"2",label:"Arrow"},{value:"3",label:"Terminator"},{value:"4",label:"Data"},{value:"5",label:"Process"},{value:"6",label:"Decision"}],I=["labeling","checking"],$=["Next","Download Labeled File"],z="annotation",B={canvasWidth:j,canvasHeight:D,lineColor:L,hoveredLineColor:E,fadedLineColor:N,cates:A,modes:I,dbcheckText:$,filenamePost:z},V={name:"Canvas",data:function(){return{labeledNum:0,totalNum:0,sketch:[],minX:0,minY:0,fileNamePre:"",result:{},canvas:null,lastObjs:[],lastZoom:1,cates:B.cates,selectVal:"",popPos:{position:"absolute"},curMode:B.modes[0],curCheckingCate:"-1",finishDialog:!1,isDbChecked:!1,staticCanvas:null,canvasImg:"",activeStep:0,activeText:B.dbcheckText[0]}},components:{Congrats:T},mounted:function(){this.initCanvas()},methods:{initCanvas:function(){this.canvas&&(this.lastObjs=this.canvas.getObjects(),this.lastZoom=this.canvas.getZoom(),this.canvas.dispose());var t=this.canvas=new p["fabric"].Canvas("canvas",{selectionColor:"rgb(112, 235, 219, 0.3)",selectionBorderColor:"rgb(0, 207, 180)",selectionFullyContained:!0,selectionKey:"ctrlKey",hoverCursor:"pointer"}),e=p["fabric"].Object.prototype;e.transparentCorners=!1,e.cornerStyle="circle",e.cornerSize=8,e.cornerColor="rgb(112, 235, 219, 0.8)",e.borderColor="rgb(0, 207, 180, 0.5)",e.lockUniScaling=!0,e.lockRotation=!0;var n=["ml","mt","mr","mb","mtr"];n.forEach(function(t){e.setControlVisible(t,!1)}),t.on("dragover",this.allowDrop),t.on("drop",this.drop),t.on("mouse:over",this.onMouseOver),t.on("mouse:out",this.onMouseOut),t.on("mouse:dblclick",this.onMouseDbClick),t.on("mouse:down",this.onMouseDown)},removeListenersFromCanvas:function(){},onMouseOver:function(t){t.target&&(t.target.set("stroke",B.hoveredLineColor),this.canvas.renderAll())},onMouseOut:function(t){t.target&&(t.target.set("stroke",B.lineColor),this.canvas.renderAll())},onMouseDbClick:function(t){if(this.canvas.getActiveObjects().length>0&&t.target){var e=t.target,n=this.getTransformedCoorid(e.left,e.top),a="px !important";this.popPos["top"]="".concat(n.y).concat(a),this.popPos["left"]="".concat(n.x+e.width*this.canvas.getZoom()).concat(a),this.selectVal="",this.$forceUpdate(),this.$refs.popover.doShow()}},onMouseDown:function(){this.$refs.popover.doClose();var t=this.canvas.getActiveObjects();0!=t.length&&t.forEach(function(t){t.set("stroke",B.lineColor)})},redrawCanvas:function(){var t=this;this.canvas.setZoom(this.lastZoom),this.lastObjs.forEach(function(e){t.canvas.add(e)})},setLabel:function(t){var e=this,n=this.canvas.getActiveObjects(),a=0;n.forEach(function(n){""===e.result[n.id]&&a++,e.result[n.id]=t}),this.labeledNum+=a},showStrokesInCate:function(t){this.curMode!==B.modes[1]&&this.switchToCheckingMode(),this.curCheckingCate=t,this.setLineColorByCate(this.canvas,t),this.canvas.renderAll()},switchToCheckingMode:function(){this.curMode=B.modes[1],this.canvas.removeListeners()},switchToLabelingMode:function(){this.curMode=B.modes[0],this.curCheckingCate="-1",this.initCanvas(),this.redrawCanvas();var t=this.canvas.getObjects();t.forEach(function(t){t.set("stroke",B.lineColor)}),this.canvas.renderAll()},setLineColorByCate:function(t,e){var n=this,a=t.getObjects();d()(this.result).forEach(function(t){var s=a.find(function(e){return e.id===t});n.result[t]===e?s.set("stroke",B.hoveredLineColor):s.set("stroke",B.fadedLineColor)})},finishLabeling:function(){this.labeledNum==this.totalNum&&0!=this.totalNum?(this.finishDialog=!0,this.isDbChecked=!1,this.activeStep=0,this.activeText=B.dbcheckText[0],this.setLineColorByCate(this.staticCanvas,String(this.activeStep+1)),this.staticCanvas.renderAll(),this.canvasImg=this.staticCanvas.toDataURL()):this.$message({message:"Labeling is not completed.",type:"warning",center:!0})},nextCheckStep:function(){var t=this;if(this.activeText===B.dbcheckText[1]){var e="",n=[];B.cates.forEach(function(t){n[v()(t.value)]=t.label}),d()(this.result).forEach(function(a){e+="".concat(a," ").concat(n[t.result[a]],"\r\n")});var a=new Blob([e],{type:"text/plain;charset=utf-8"});return Object(m["saveAs"])(a,"".concat(this.fileNamePre,"_").concat(B.filenamePost,".txt")),void(this.isDbChecked=!0)}this.activeStep++,this.checkConfirmText()},setActiveStep:function(t){this.activeStep=v()(t)-1,this.checkConfirmText()},checkConfirmText:function(){this.setLineColorByCate(this.staticCanvas,String(this.activeStep+1)),this.staticCanvas.renderAll(),this.canvasImg=this.staticCanvas.toDataURL(),this.activeStep>=this.cates.length-1?this.activeText=B.dbcheckText[1]:this.activeText=B.dbcheckText[0]},dragStart:function(){},allowDrop:function(t){var e=t.e;e.preventDefault(),e.dataTransfer.dropEffect="move"},drop:function(t){var e=this,n=t.e;n.preventDefault(),this.sketch=[],this.result={},this.labeledNum=0,this.canvas.clear().renderAll(),this.staticCanvas=new p["fabric"].StaticCanvas("static-canvas");var a=n.dataTransfer.files;if(0!==a.length){var s=a[0],i=s.name.split("_");this.fileNamePre="".concat(i[0],"_").concat(i[1],"_").concat(i[2]);var o=null,r=new FileReader;r.onload=function(t){var n=new b.a;o=n.xml2js(t.target.result);for(var a=o.ink.trace,s=0;s<a.length;s++){var i=new M(o.ink.trace[s]["_xml:id"]);e.result[i.id]="";for(var r=a[s].__text.split(", "),c=0;c<r.length;c++){var l=r[c].split(" ");i.addPoint(new O(v()(l[0]),v()(l[1])))}e.sketch.push(i)}e.totalNum=e.sketch.length,e.minX=e.getMinXInSketch(),e.minY=e.getMinYInSketch(),e.draw()},r.readAsText(s)}},draw:function(){for(var t=0;t<this.sketch.length;t++)this.canvas.add(this.getStrokePath(this.sketch[t]));for(var e=0;e<this.sketch.length;e++){for(var n=this.sketch[e],a=this.initialTransform(n.getPoint(0)),s="M ".concat(a.x," ").concat(a.y," "),i=1;i<n.points.length;i++){var o=this.initialTransform(n.getPoint(i));s+="L ".concat(o.x," ").concat(o.y," ")}var r=new p["fabric"].Path(s);r.set({fill:"",stroke:B.lineColor}),Object.defineProperty(r,"id",{value:n.id}),this.staticCanvas.add(r)}},getStrokePath:function(t){for(var e=this.initialTransform(t.getPoint(0)),n="M ".concat(e.x," ").concat(e.y," "),a=1;a<t.points.length;a++){var s=this.initialTransform(t.getPoint(a));n+="L ".concat(s.x," ").concat(s.y," ")}var i=new p["fabric"].Path(n,{lockScalingX:!0,lockScalingY:!0,lockRotation:!0,lockMovementX:!0,lockMovementY:!0,perPixelTargetFind:!0,cornerSize:5,cornerStyle:"circle"});i.set({fill:"",stroke:B.lineColor});var o=["ml","mt","mr","mb","mtr"];//!:)
return o.forEach(function(t){i.setControlVisible(t,!1)}),Object.defineProperty(i,"id",{value:t.id}),i},zoom:function(t){var e=this.canvas.getZoom();e+=.2*t,e>4&&(e=4),e<.1&&(e=.1),this.canvas.zoomToPoint(new p["fabric"].Point(0,0),e)},initialTransform:function(t){return new O((t.x-this.minX+50)/2,(t.y-this.minY+50)/2)},initialTransform2:function(t){return new O(t.x/2,t.y/2)},getMinXInSketch:function(){var t=1/0;return this.sketch.forEach(function(e){e.points.forEach(function(e){e.x<t&&(t=e.x)})}),t},getMinYInSketch:function(){var t=1/0;return this.sketch.forEach(function(e){e.points.forEach(function(e){e.y<t&&(t=e.y)})}),t},getTransformedCoorid:function(t,e){var n=this.canvas.viewportTransform,a=new p["fabric"].Point(t,e);return a.x=n[0]*t+n[2]*e+n[4],a.y=n[1]*t+n[3]*e+n[5],a}}},X=V,Y=(n("d3a0"),Object(x["a"])(X,l,u,!1,null,"baa88d96",null)),Z=Y.exports,F={name:"app",components:{Canvas:Z}},R=F,U=(n("034f"),Object(x["a"])(R,r,c,!1,null,null,null)),J=U.exports;n("c860");a["default"].config.productionTip=!1,a["default"].prototype.$ELEMENT={size:"small"},a["default"].use(s["Option"]),a["default"].use(s["Select"]),a["default"].use(s["Popover"]),a["default"].use(s["Button"]),a["default"].use(s["Dialog"]),a["default"].use(s["Steps"]),a["default"].use(s["Step"]),a["default"].component(s["Message"].name,s["Message"]),a["default"].prototype.$message=s["Message"],a["default"].use(o.a,{ops:{vuescroll:{},scrollPanel:{},rail:{},bar:{background:"#a8a8a8",onlyShowBarOnScroll:!1}}}),new a["default"]({render:function(t){return t(J)}}).$mount("#app")},"64a9":function(t,e,n){},aa54:function(t,e,n){},c860:function(t,e,n){},d3a0:function(t,e,n){"use strict";var a=n("2266"),s=n.n(a);s.a}});
//# sourceMappingURL=app.eee8d264.js.map